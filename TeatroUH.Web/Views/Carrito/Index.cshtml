@model List<TeatroUH.Application.Models.Cartitem>

@{
    ViewData["Title"] = "Carrito";
    decimal total = ViewBag.Total is decimal d ? d : 0m;
}

<div class="max-w-5xl mx-auto px-4 py-10">

    <div class="flex items-start justify-between gap-4 mb-8">
        <div>
            <h1 class="text-3xl font-semibold text-white">Carrito</h1>
            <p class="text-gray-400 mt-1">Revisá tus funciones antes de confirmar.</p>
        </div>

        <div class="flex gap-3">
            <a asp-controller="Funciones" asp-action="Index"
               class="inline-flex items-center justify-center rounded-lg px-4 py-2 font-semibold
                      border border-white/15 bg-black/30 text-white hover:bg-black/40 transition">
                Seguir viendo funciones
            </a>

            <form asp-controller="Carrito" asp-action="Clear" method="post">
                @Html.AntiForgeryToken()
                <button type="submit"
                        class="inline-flex items-center justify-center rounded-lg px-4 py-2 font-semibold
                               bg-red-600/90 text-white hover:bg-red-600 transition">
                    Vaciar
                </button>
            </form>
        </div>
    </div>

    @if (Model == null || !Model.Any())
    {
        <div class="rounded-2xl border border-white/10 bg-black/35 p-8 text-center">
            <p class="text-white font-semibold text-lg">Tu carrito está vacío.</p>
            <p class="text-gray-400 mt-1">Agregá una función para continuar.</p>

            <a asp-controller="Funciones" asp-action="Index"
               class="mt-6 inline-flex items-center justify-center rounded-lg px-5 py-2.5 font-semibold
                          bg-[#C9A24D] text-black hover:brightness-110 transition">
                Ir a funciones
            </a>
        </div>
    }
    else
    {
        <div class="rounded-2xl border border-white/10 bg-black/35 overflow-hidden">

            <div class="p-5 border-b border-white/10 text-gray-300 text-sm">
                Items en carrito: <span class="text-white font-semibold">@Model.Count</span>
            </div>

            <div class="divide-y divide-white/10">
                @foreach (var item in Model)
                {
                    <div class="p-5 flex items-center justify-between gap-4">
                        <div>
                            <div class="text-white font-semibold">
                                Función #@item.ShowtimeId
                            </div>
                            <div class="text-gray-400 text-sm">
                                Cantidad: <span class="text-gray-200 font-semibold">@item.Quantity</span>
                            </div>
                        </div>

                        <form asp-controller="Carrito" asp-action="Remove" method="post">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="showtimeId" value="@item.ShowtimeId" />
                            <button type="submit"
                                    class="rounded-lg px-4 py-2 font-semibold
                                                   border border-white/15 bg-black/30 text-white hover:bg-black/40 transition">
                                Quitar
                            </button>
                        </form>
                    </div>
                }
            </div>

            <div class="p-6 flex flex-col sm:flex-row items-center justify-between gap-4 border-t border-white/10">
                <div class="text-gray-300">
                    Total:
                    <span class="text-white text-xl font-semibold">₡@total.ToString("N2")</span>
                </div>

                <a asp-controller="Carrito" asp-action="Confirmar"
                   class="inline-flex items-center justify-center rounded-lg px-6 py-3 font-semibold
                              bg-[#C9A24D] text-black hover:brightness-110 transition">
                    Confirmar
                </a>
            </div>
        </div>
    }
</div>
