@model List<TeatroUH.Domain.Entities.Showtime>

@{
    ViewData["Title"] = "Funciones";
}

<div class="funciones-bg">
    <div class="funciones-overlay">

        <div class="w-full max-w-6xl mx-auto">

            <!-- Header -->
            <div class="text-center mb-10">
                <h1 class="text-4xl font-semibold tracking-wide text-white">Funciones</h1>
                <p class="text-gray-300 mt-2">Seleccioná una función disponible y agregala al carrito.</p>

                <div class="mt-3 text-sm text-gray-400">
                    Total funciones:
                    <strong class="text-white">@((Model?.Count ?? 0))</strong>
                </div>

                <div class="mt-6 flex justify-center gap-3">
                    <a asp-controller="Obras" asp-action="Index"
                       class="inline-flex items-center justify-center rounded-lg px-4 py-2 font-semibold
                              border border-white/15 bg-black/30 text-white hover:bg-black/40 transition">
                        Volver a obras
                    </a>

                    <a asp-controller="Carrito" asp-action="Index"
                       class="inline-flex items-center justify-center rounded-lg px-4 py-2 font-semibold
                        bg-[#C9A24D] text-black hover:brightness-110 transition">
                        Ver carrito
                    </a>

                </div>
            </div>

            @if (Model == null || !Model.Any())
            {
                <div class="rounded-xl border border-white/10 bg-black/40 p-6 text-center">
                    <p class="text-gray-200 font-semibold">No hay funciones disponibles.</p>
                    <p class="text-gray-400 text-sm mt-1">Revisá el seed o las migraciones.</p>
                </div>
            }
            else
            {
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    @foreach (var f in Model)
                    {
                        <article class="rounded-2xl border border-white/10 bg-black/35 backdrop-blur-sm
                                               overflow-hidden shadow-lg hover:shadow-xl transition">

                            <div class="p-6">
                                <!-- Título -->
                                <div class="flex items-start justify-between gap-4">
                                    <div>
                                        <h2 class="text-lg font-semibold text-white leading-tight line-clamp-2">
                                            🎭 @(f.Play?.Title ?? $"Obra #{f.PlayId}")
                                        </h2>
                                        <p class="text-gray-400 text-sm mt-1">
                                            Teatro: <span class="text-gray-200">@(f.Theater?.Name ?? $"Teatro #{f.TheaterId}")</span>
                                        </p>
                                    </div>

                                    <div class="text-right">
                                        <div class="text-xs text-gray-400">Precio base</div>
                                        <div class="text-white font-semibold">₡@f.BasePrice.ToString("N2")</div>
                                    </div>
                                </div>

                                <!-- Datos -->
                                <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
                                    <div class="rounded-lg border border-white/10 bg-black/30 p-3">
                                        <div class="text-gray-400">Fecha</div>
                                        <div class="text-white font-semibold">
                                            @f.StartDateTime.ToString("dd/MM/yyyy")
                                        </div>
                                    </div>

                                    <div class="rounded-lg border border-white/10 bg-black/30 p-3">
                                        <div class="text-gray-400">Hora</div>
                                        <div class="text-white font-semibold">
                                            @f.StartDateTime.ToString("hh:mm tt")
                                        </div>
                                    </div>
                                </div>

                                <div class="text-xs text-gray-400 mt-2">
                                    Disponibles:
                                    <span class="text-white font-semibold">@f.SeatsAvailable</span>
                                    / @f.Capacity
                                </div>



                                <!-- Acciones -->
                                <div class="mt-5 flex flex-col sm:flex-row gap-3">
                                    <form asp-controller="Carrito" asp-action="Add" method="post" class="flex-1">
                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="showtimeId" value="@f.ShowtimeId" />
                                        <input type="hidden" name="qty" value="1" />
                                        <button type="submit"
                                                class="w-full rounded-lg py-2.5 font-semibold text-black
                                             bg-[#C9A24D] hover:brightness-110 transition">
                                            Agregar al carrito
                                        </button>
                                    </form>


                                    <a asp-controller="Funciones" asp-action="Detalle" asp-route-id="@f.ShowtimeId"
                                       class="flex-1 inline-flex items-center justify-center rounded-lg py-2.5 font-semibold
                                                      border border-white/15 bg-black/30 text-white hover:bg-black/40 transition">
                                        Ver detalle
                                    </a>
                                </div>

                            </div>
                        </article>
                    }
                </div>
            }

        </div>
    </div>
</div>
